#!/bin/bash
##################################################
# Intel + Vulkan Driver
##################################################
# paru -S xf86-video-intel lib32-mesa vulkan-intel lib32-vulkan-intel vulkan-tools
# sudo vim /etc/X11/xorg.conf.d/20-intel.conf
#
# Section "Device"
#    Identifier  "Intel Graphics"
#    Driver      "intel"
#    Option      "DRI"    "3"
# EndSection

##################################################
# GNOME SHELL LOGIN
##################################################
# [X] Choose before login with your username the session 'Gnome with X11' instead of 'Gnome'

##################################################
# ARCH UPDATE INDICATOR
#################################################
# https://github.com/RaphaelRochet/arch-update/wiki

# Settings: Check Update Command
# /bin/sh -c "(/usr/bin/checkupdates; /usr/bin/paru -Qqu --color never | sed 's/Get .*//') | sort -u -t' ' -k1,1"

# Settings: Update Command
# gnome-terminal -e 'sh -c  "ecos-update"'

##################################################
# FIREFOX THEME
##################################################
# Start Firefox once and execute command:
# $HOME/.cache/theme/tweaks.sh --firefox

##################################################
# NVIDIA DRIVER
##################################################

# https://wiki.archlinux.org/title/Bumblebee
# paru -S mesa nvidia-390xx lib32-nvidia-390xx-utils bumblebee bbswitch primus lib32-virtualgl
# (optional): paru -S xf86-video-intel

# sudo gpasswd -a $USER bumblebee
# sudo systemctl enable bumblebeed.service

# Test
# optirun glxspheres64
# primusrun glxspheres64

##################################################
# Refresh Mirrorlist
##################################################
# paru -S reflector
# sudo reflector --verbose --country 'Germany' -l 15 -p https --sort rate --save /etc/pacman.d/mirrorlist

##################################################
# PACKAGES
##################################################
packages=""

# Gnome Minimal -  https://archlinux.org/groups/x86_64/gnome/
packages="$packages gdm gnome-shell gnome-control-center gnome-terminal nautilus xdg-user-dirs"

# Gnome Shell Extensions
packages="$packages chrome-gnome-shell-git"
packages="$packages gnome-shell-extensions"
packages="$packages gnome-shell-extension-tray-icons-reloaded-git"
packages="$packages gnome-shell-extension-sound-output-device-chooser"
packages="$packages gnome-shell-extension-arch-update"
packages="$packages gnome-shell-extension-dash-to-dock-gnome40-git"
packages="$packages gnome-shell-extension-gsconnect"
packages="$packages gnome-shell-extension-caffeine-git"
packages="$packages gnome-shell-extension-blur-my-shell-git"
packages="$packages gnome-shell-extension-just-perfection-desktop-git"
packages="$packages gnome-shell-extension-x11gestures touchegg"
#packages="$packages gnome-shell-extension-appindicator-git"
#packages="$packages gnome-shell-extension-status-area-horizontal-spacing"
#packages="$packages gnome-shell-extension-clipboard-indicator-git"

# ZSH
packages="$packages zsh-autosuggestions zsh-syntax-highlighting"

# System Tools
packages="$packages gnome-keyring"
packages="$packages gnome-tweak-tool gnome-system-monitor"
packages="$packages evince eog gedit gnome-calculator totem"
packages="$packages gnome-disk-utility gnome-usage"
packages="$packages gnome-screenshot"
packages="$packages gnome-backgrounds"
packages="$packages pacman-contrib"
packages="$packages man-db"
packages="$packages hunspell hunspell-en_us hunspell-de"
packages="$packages samba"
packages="$packages gvfs gvfs-mtp gvfs-smb gvfs-nfs"
packages="$packages gnome-user-share nfs-utils"

# Misc
packages="$packages wmctrl zenity ffmpeg youtube-dl rsync"

# Hide mouse pointer
packages="$packages unclutter"

# Codecs
packages="$packages gst-libav"

# Archive Manager
packages="$packages file-roller zip unzip unrar"

# Apps
packages="$packages firefox"
packages="$packages gnome-calendar"
packages="$packages gnome-weather"
packages="$packages rhythmbox-plugin-alternative-toolbar-git"
packages="$packages geary"
packages="$packages keepassxc"
packages="$packages libreoffice-still-de"

# Fonts
packages="$packages ttf-dejavu"
packages="$packages ttf-liberation"
packages="$packages noto-fonts-emoji"
packages="$packages lib32-fontconfig"

# Icons
packages="$packages qogir-icon-theme-git luv-icon-theme-git"

# Vim
packages="$packages vim"

# VSCodium
packages="$packages vscodium-bin vscodium-bin-marketplace"

# Spotify
#curl -sS https://download.spotify.com/debian/pubkey_0D811D58.gpg | gpg --import -
#packages="$packages spotify-adblock-git"

# Kodi
#packages="$packages kodi-x11 kodi-addon-inputstream-adaptive"

# Steam
#packages="$packages steam"

# Lutris
# Wine: https://github.com/lutris/docs/blob/master/WineDependencies.md
# Graphic Driver: https://github.com/lutris/docs/blob/master/InstallingDrivers.md
#packages="$packages lutris lutris-wine-meta"

# Install packages
paru --noconfirm --needed --sudoloop -Syyu $packages

##################################################
# ENABE GNOME SERVICE
##################################################
sudo systemctl enable gdm.service
sudo sed -i "s/^#WaylandEnable=false/WaylandEnable=false/g" "/etc/gdm/custom.conf"

##################################################
# SAMBA
##################################################
if [ ! -f "/etc/samba/smb.conf" ]; then
    {
        echo "[global]"
        echo "   workgroup = WORKGROUP"
        echo "   log file = /var/log/samba/%m"
    } >"/tmp/smb.conf"
    sudo mv "/tmp/smb.conf" "/etc/samba/smb.conf"
fi

sudo systemctl enable smb.service
sudo systemctl enable nmb.service

##################################################
# TLP
##################################################
if [ -f "/etc/tlp.conf" ]; then
    sudo sed -i "s/^#CPU_BOOST_ON_AC=1/CPU_BOOST_ON_AC=0/g" "/etc/tlp.conf"
    sudo sed -i "s/^#CPU_BOOST_ON_BAT=0/CPU_BOOST_ON_BAT=0/g" "/etc/tlp.conf"
fi

##################################################
# SERVICES
##################################################
sudo systemctl enable touchegg.service --now
sudo systemctl enable avahi-daemon
sudo systemctl enable bluetooth.service

##################################################
# GNOME TERMINAL PADDING
##################################################
mkdir -p "$HOME/.config/gtk-3.0"
echo 'VteTerminal,
TerminalScreen,
vte-terminal {
    padding: 24px 32px 32px 32px;
    -VteTerminal-inner-border: 12px 12px 12px 12px;
}' >"$HOME/.config/gtk-3.0/gtk.css"

##################################################
# THEME
##################################################
THEME_INSTALL_DIR=$HOME/.cache/theme
THEME_CSS_FILE=$HOME/.themes/WhiteSur-light/gnome-shell/gnome-shell.css

rm -rf "$THEME_INSTALL_DIR"
git clone https://github.com/vinceliuice/WhiteSur-gtk-theme.git "$THEME_INSTALL_DIR"

# Theme WhiteSur (https://github.com/vinceliuice/WhiteSur-gtk-theme)
$THEME_INSTALL_DIR/install.sh --icon simple --nautilus-style glassy --size 280 --background blank --theme default --normalshowapps --panel default
$THEME_INSTALL_DIR/tweaks.sh --firefox

# Disable App Icon
APP_START='#panel .panel-button .app-menu-icon {'
APP_CONTENT='  width: 0;\n  height: 0;\n  margin: 0;'
APP_END='}'

# Modify Tray Icon Space
STATUS_START='#panel .panel-button .system-status-icon {'
STATUS_CONTENT='  icon-size: 16px;\n  padding: 4px 10px;\n  margin: 0 1px;'
STATUS_END='}'

STATUS_PADDING_START='#panel .panel-button {'
STATUS_PADDING_CONTENT='  -natural-hpadding: 4px;\n  -minimum-hpadding: 4px;\n  font-weight: normal;\n  color: white;\n  transition-duration: 150ms;\n  border-radius: 6px;'
STATUS_PADDING_END='}'

# https://fahdshariff.blogspot.com/2012/12/sed-mutli-line-replacement-between-two.html
sed -ni "/$STATUS_START/{p;:a;N;/$STATUS_END/!ba;s/.*\n/$STATUS_CONTENT\n/};p" "$THEME_CSS_FILE"
sed -ni "/$APP_START/{p;:a;N;/$APP_END/!ba;s/.*\n/$APP_CONTENT\n/};p" "$THEME_CSS_FILE"
sed -ni "/$STATUS_PADDING_START/{p;:a;N;/$STATUS_PADDING_END/!ba;s/.*\n/$STATUS_PADDING_CONTENT\n/};p" "$THEME_CSS_FILE"
