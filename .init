#!/bin/bash

##################################################

# Gnome Shell Login
# Choose before login with your username the session 'Gnome with X11' instead of  'Gnome'

#################################################

# Arch Update Indicator
# https://github.com/RaphaelRochet/arch-update/wiki
# Check Update Command
# /bin/sh -c "(/usr/bin/checkupdates; /usr/bin/paru -Qqu --color never | sed 's/Get .*//') | sort -u -t' ' -k1,1"

# Update Command
# gnome-terminal -e 'sh -c  "update-system" '

##################################################


# PACKAGES
##################################################

packages=""

# Gnome Minimal -  https://archlinux.org/groups/x86_64/gnome/
packages="$packages gdm gnome-shell gnome-control-center gnome-terminal nautilus xdg-user-dirs"

# Gnome Shell Extensions
packages="$packages gnome-shell-extensions"
packages="$packages gnome-shell-extension-appindicator-git"
packages="$packages gnome-shell-extension-sound-output-device-chooser"
packages="$packages gnome-shell-extension-arch-update"
packages="$packages gnome-shell-extension-dash-to-dock-gnome40-git"
packages="$packages gnome-shell-extension-gsconnect"
packages="$packages gnome-shell-extension-caffeine-git"
packages="$packages gnome-shell-extension-clipboard-indicator-git"
packages="$packages gnome-shell-extension-blur-my-shell-git"

# Driver
packages="$packages xf86-video-intel"

# ZSH
packages="$packages zsh-autosuggestions zsh-syntax-highlighting"

# System Tools
packages="$packages gnome-tweak-tool gnome-system-monitor"
packages="$packages evince eog gedit gnome-calculator totem"
packages="$packages gnome-disk-utility"
packages="$packages gnome-screenshot"
packages="$packages gnome-backgrounds"
packages="$packages pacman-contrib"
packages="$packages man-db"
packages="$packages hunspell hunspell-en_us hunspell-de"

# Hide mouse pointer
packages="$packages unclutter"  

# Codecs
packages="$packages gst-libav"

# Archive Manager
packages="$packages file-roller zip unzip unrar"

# Apps
packages="$packages firefox"
packages="$packages gnome-calendar"
packages="$packages gnome-weather"
packages="$packages gnome-music"
packages="$packages geary"
packages="$packages keepassxc"
packages="$packages libreoffice-still-de"

# Fonts
packages="$packages ttf-dejavu"
packages="$packages ttf-liberation"
packages="$packages noto-fonts-emoji"
packages="$packages lib32-fontconfig"

# Icons
packages="$packages arc-icon-theme luv-icon-theme-git"

# Vim
packages="$packages vim"

# VSCodium
packages="$packages vscodium-bin vscodium-bin-marketplace"

# Spotify
packages="$packages spotify-adblock-git"

# Kodi
#packages="$packages kodi-x11 kodi-addon-inputstream-adaptive"

# Steam
#packages="$packages steam"

# Install packages
paru --noconfirm --needed --sudoloop -Syyu $packages


# SERVICES
##################################################
sudo systemctl enable gdm.service


# THEME
##################################################
THEME_INSTALL_DIR=$HOME/.cache/WhiteSur-gtk-theme-master
THEME_CSS_FILE=$HOME/.themes/WhiteSur-light/gnome-shell/gnome-shell.css

rm -rf "$THEME_INSTALL_DIR"
git clone https://github.com/vinceliuice/WhiteSur-gtk-theme.git "$THEME_INSTALL_DIR"

# Theme WhiteSur (https://github.com/vinceliuice/WhiteSur-gtk-theme)
$THEME_INSTALL_DIR/install.sh --icon simple --nautilus-style default --size 280 --background blank --theme default --normalshowapps --panel default

APP_START='#panel .panel-button .app-menu-icon {'
APP_CONTENT='  width: 0;\n  height: 0;\n  margin: 0;'
APP_END='}'

STATUS_START='#panel .panel-button .system-status-icon {'
STATUS_CONTENT='  icon-size: 14px;\n  padding: 4px 10px;\n  margin: 0 1px;'
STATUS_END='}'

STATUS_PADDING_START='#panel .panel-button {'
STATUS_PADDING_CONTENT='  -natural-hpadding: 4px;\n  -minimum-hpadding: 4px;\n  font-weight: normal;\n  color: white;\n  transition-duration: 150ms;\n  border-radius: 6px;'
STATUS_PADDING_END='}'

# https://fahdshariff.blogspot.com/2012/12/sed-mutli-line-replacement-between-two.html
sed -ni "/$STATUS_START/{p;:a;N;/$STATUS_END/!ba;s/.*\n/$STATUS_CONTENT\n/};p" "$THEME_CSS_FILE"
sed -ni "/$APP_START/{p;:a;N;/$APP_END/!ba;s/.*\n/$APP_CONTENT\n/};p" "$THEME_CSS_FILE"
sed -ni "/$STATUS_PADDING_START/{p;:a;N;/$STATUS_PADDING_END/!ba;s/.*\n/$STATUS_PADDING_CONTENT\n/};p" "$THEME_CSS_FILE"
